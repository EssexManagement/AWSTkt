# 2024-Feb Ticket 1 - Increase # of Authorizers per API

We have almost 50 Lambdas under one single API-Gateway REST-API, and that count is growing.

WHAT WE WANT:-  Please increase the Default-Quota for Authorizers per API = 15, as it can be increased for this account as per:
Per https://docs.aws.amazon.com/apigateway/latest/developerguide/limits.html

EXAMPLE STACK: https://us-east-1.console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/stackinfo?stackId=arn%3Aaws%3Acloudformation%3Aus-east-1%3A127516845550%3Astack%2FFACT-backend-dev-Lambdas-9%2F58cb0ff0-cc10-11ee-be26-128ad93e7ec9

```
2024-02-15 09:47:08 UTC-0500	lambdas9emFactAuthorizer0DC9864B
CREATE_FAILED
Maximum number of Authorizers for this API has been reached. Please contact AWS if you need additional Authorizers. (Service: ApiGateway, Status Code: 429, Request ID: 532aa96a-39e9-4e11-8b39-5925d43b5a0f)
```

<HR/>
<HR/>
<HR/>

# 2024-Feb Ticket 2 - CDK assistance for 50+ lambdas under one APIGW-RestAPI

Our solution has a bit under 50 lambdas behind a single API gateway rest API.<BR/>
As much as possible, everything is generated using CDK, using only level-1 constructs.

Ideally, we would like the CW-Logs retention requirements (for Lambdas and REST-Api) to be handled within CDK.<BR/>
Therefore, we are setting the log retention when creating the lambda using the Level-2 CDK construct `python_lambda.PythonFunction(..)` as:

```
    python_lambda.PythonFunction( ..
        ..
        log_retention=aws_logs.RetentionDays.FIVE_DAYS if branch in ["prod"] else aws_logs.RetentionDays.ONE_YEAR,
```

Ideally, for EACH Log-Group (whether Lambda or APIGW's REST-Api), we would also like the CDK code to create a DataDog-Kinesis subscription as:

```
    logs.SubscriptionFilter( scope=self, id= ..
        destination = datadog_destination,
        log_group = handler.log_group,
        filter_pattern = logs.FilterPattern.all_events(),
        ### filter_name= automatically genereated if NOT specified
    )
```

The problem: The resulting "single" cloudformation-template (as generated by CDK) is 100s of KB in size, way beyond the 51KB limit for Cloudformation-Templates.<BR/>
REF: https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cloudformation-limits.html <BR/>
Template body size in a request: Maximum size of a template body that you can pass in a CreateStack, UpdateStack, or ValidateTemplate request = 51,200 bytes

What we tried:
1.  Split up the stack into > 10 stacks, so that each Stack's cloudformation-template is < 51KB limit.
1.  Remove whitespaces in the cdk-generated cloudformation-templates (to reduce file-size < 51KB).. .. which could Not be done, due to the way CodePipeline automatically generates CFTs via CDK.

HELP NEEDED:
1.  CDK Best Practice to SHARE a single APIGW REST-API and its single-unique AUthorizer across 100s of Lambdas deployed via multiple stacks.
1.  Reduce the # of `lambda:InvokeFunction` CFT-resources, by batching them into a single CFT-Resource (within each stack)
1.  Reduce the # of `Custom::LogRetention` CFT-resources, by .. perhaps .. sharing them for ALL the lambdas within a stack.
1.  Understand how CodePipeline gets around the 50KB size limit for Cloudformation-template JSON files.

# EoF
